@{
    Layout = "_Layout";
    ViewData["Title"] = "İlan Ver";
}

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">İlan Ver</h2>
        <small class="text-muted">Yeni araç ilanı oluşturma</small>
    </div>

    @* Başarı/hata mesajları burada gösterilecek *@
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success" role="alert">
            @TempData["SuccessMessage"]
        </div>
    }
    else if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger" role="alert">
            @TempData["ErrorMessage"]
        </div>
    }

    <form asp-controller="Vehicle" asp-action="Create" method="post" enctype="multipart/form-data" class="row g-4">
        @Html.AntiForgeryToken()

        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">İlan Başlığı <span class="text-danger">*</span></label>
                        <input name="Title" class="form-control" placeholder="Örn: Renault Clio 2018 - Full Bakımlı" required />
                    </div>

                    <div class="row g-2">
                        <div class="col-sm-6 mb-3">
                            <label class="form-label">Marka <span class="text-danger">*</span></label>
                            <input name="Make" class="form-control" placeholder="Örn: Renault" required />
                        </div>
                        <div class="col-sm-6 mb-3">
                            <label class="form-label">Model</label>
                            <input name="Model" class="form-control" placeholder="Örn: Clio" />
                        </div>
                    </div>

                    <div class="row g-2">
                        <div class="col-6 mb-3">
                            <label class="form-label">Yıl</label>
                            <input name="Year" type="number" min="1980" max="@DateTime.Now.Year" value="@DateTime.Now.Year" class="form-control" />
                        </div>
                        <div class="col-6 mb-3">
                            <label class="form-label">Kilometre (km)</label>
                            <input name="Mileage" type="number" min="0" value="50000" class="form-control" />
                        </div>
                    </div>

                    <div class="row g-2">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Yakıt</label>
                            <select name="Fuel" class="form-select">
                                <option value="Benzin">Benzin</option>
                                <option value="Dizel">Dizel</option>
                                <option value="Elektrik">Elektrik</option>
                                <option value="Hibrit">Hibrit</option>
                                <option value="GPL">GPL</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Vites</label>
                            <select name="Transmission" class="form-select">
                                <option value="Manuel">Manuel</option>
                                <option value="Otomatik">Otomatik</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Motor Hacmi (cc)</label>
                            <input name="Engine" type="number" min="600" class="form-control" value="1400" />
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Durum</label>
                        <select name="Condition" class="form-select">
                            <option value="Yeni">Yeni</option>
                            <option value="Çok İyi">Çok İyi</option>
                            <option value="İyi" selected>İyi</option>
                            <option value="Orta">Orta</option>
                            <option value="Hasarlı">Hasarlı</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Fiyat (TL) <span class="text-danger">*</span></label>
                        <input name="Price" id="priceInput" type="number" min="0" class="form-control" placeholder="Örn: 450000" required />
                        <div class="form-text">Rakam girin; gönderim backend tarafından işlenecektir.</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">İlan Açıklaması</label>
                        <textarea name="Description" rows="6" class="form-control" placeholder="Aracın durumu, ek bilgiler, servis kayıtları..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <aside class="col-lg-4">
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <h6 class="mb-3">Fotoğraflar</h6>
                    <div class="mb-2">
                        <input name="Photos" id="photos" type="file" accept="image/*" multiple class="form-control" />
                    </div>
                    <div id="preview" class="d-flex flex-wrap gap-2">
                        <div class="text-muted small">Seçilen fotoğraflar burada görünecek.</div>
                    </div>
                </div>
            </div>

            @* İLETİŞİM bölümü kaldırıldı *@

            <div class="d-grid">
                <button type="submit" class="btn btn-primary">İlanı Oluştur</button>
                <a asp-controller="Vehicle" asp-action="Index" class="btn btn-outline-secondary mt-2">İptal</a>
            </div>
        </aside>
    </form>
</div>

@section Scripts {
    <script>
        (function () {
            // Fotoğraf önizleme
            const photosEl = document.getElementById('photos');
            const previewEl = document.getElementById('preview');

            function createThumb(file) {
                const box = document.createElement('div');
                box.style.width = '96px';
                box.style.height = '72px';
                box.style.overflow = 'hidden';
                box.style.border = '1px solid #e9ecef';
                box.style.borderRadius = '4px';
                box.style.display = 'inline-block';
                box.style.position = 'relative';
                box.style.background = '#f8f9fa';

                const img = document.createElement('img');
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                img.alt = file.name;

                box.appendChild(img);

                const reader = new FileReader();
                reader.onload = function (e) {
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);

                return box;
            }

            if (photosEl && previewEl) {
                photosEl.addEventListener('change', function () {
                    previewEl.innerHTML = '';
                    const files = Array.from(photosEl.files).slice(0, 8); // maksimum 8 önizleme
                    if (!files.length) {
                        previewEl.innerHTML = '<div class="text-muted small">Seçilen fotoğraflar burada görünecek.</div>';
                        return;
                    }
                    files.forEach(f => {
                        if (!f.type.startsWith('image/')) return;
                        const t = createThumb(f);
                        previewEl.appendChild(t);
                    });
                });
            }

            // Basit fiyat gösterimi (isteğe bağlı)
            const priceInput = document.getElementById('priceInput');
            if (priceInput) {
                priceInput.addEventListener('input', function () {
                    //: yalnızca kullanıcı deneyimi; değer değişmez
                    const val = parseInt(this.value || '0', 10);
                    this.title = isNaN(val) ? '' : new Intl.NumberFormat('tr-TR').format(val) + ' TL';
                });
            }
        })();
    </script>
}